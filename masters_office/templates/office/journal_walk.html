{% extends 'base.html' %}
{% block title %} Журнал обходов тепловых сетей {% endblock title %}

{% block content %}

{% for message in messages %}
  {% if message.tags == 'success' %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Закрыть"></button>
    </div>
  {% endif %}
{% endfor %}

<br>
<h1 class="text-center fw-light">Журнал обходов тепловых сетей</h1>
<h1 class="text-center fw-medium">{{ district }}</h1>
<br>
{% if page_obj %}
<div class="d-grid gap-2 col-2 mx-auto">
    <a class="btn btn-outline-dark btn-lg fs-3" href="{% url 'office:create_post_walking' journal.slug district.slug %}">Новая запись</a>
</div>
<div class="row justify-content-center">
    <div class="col-md-20 p-5">
      {% include 'includes/paginator.html' %}
      <div class="card">
        <div class="card-header fs-4">
          {% for post in page_obj %}
              <b>Номер записи:</b> {{ post.number_post }}
              <br>
              <b>Дата обхода:</b> {{ post.walk_date|date:"d E Y" }}
              <br>
              <b>Причина обхода:</b>
              {% if post.planned %} Плановый {% endif %}
              {% if post.not_planned %} Внеплановый {% endif %}
              <br>
              <b>Ф.И.О обходчиков:</b>
              {% for member in post.members.all %}
                  {{ member }}
                  {% if not forloop.last %} , {% endif %}
              {% endfor %}    
              <br>
              <b>Участок теплотрассы, задание мастера:</b> {{ post.task }}
              <br>
              <b>Замечания, выявленные при обходе:</b> {{ post.text|truncatechars:15 }}
              <br>
              <b>Автор:</b> {{ post.author.get_full_name }} ({{ post.author }})
              <p>
                <a class="btn btn-outline-dark btn-sm" href="{{ post.get_absolute_url }} ">подробная информация </a>
                {% if post.author.id == user.id %}
                <a class="btn btn-outline-dark btn-sm" href="{% url 'office:edit_post_walking' journal.slug district.slug post.id %}">Редактировать запись</a>
                {% else %}
                <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Вы не автор записи!">
                  <button class="btn btn-outline-dark btn-sm" type="button" disabled>Редактировать запись</button>
                </span>     
                {% endif %}
              </p>
              {% if not forloop.last %} <hr> {% endif %}
          {% endfor %}
          {% else %}
          <p class="text-center fs-1">Записей нет.</p>
      {% endif %}
        </div>
      </div>
      {% include 'includes/paginator.html' %}
    </div>
  </div>
  <div class="d-grid gap-2 col-2 mx-auto">
    <a class="btn btn-outline-dark btn-lg fs-3" href="{% url 'office:create_post_walking' journal.slug district.slug %}">Новая запись</a>
  </div>
{% endblock content %}
